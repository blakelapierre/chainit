!function a(s,c,i){function u(t,e){if(!c[t]){if(!s[t]){var n="function"==typeof require&&require;if(!e&&n)return n(t,!0);if(l)return l(t,!0);var r=new Error("Cannot find module '"+t+"'");throw r.code="MODULE_NOT_FOUND",r}var o=c[t]={exports:{}};s[t][0].call(o.exports,function(e){return u(s[t][1][e]||e)},o,o.exports,a,s,c,i)}return c[t].exports}for(var l="function"==typeof require&&require,e=0;e<i.length;e++)u(i[e]);return u}({1:[function(e,t,n){"use strict";var s=e("preact-cycle"),F=r(e("bitcore-lib-cash")),k=r(e("lz-string"));function r(e){return e&&e.__esModule?e:{default:e}}function c(e){if(null==e)throw new TypeError("Cannot destructure undefined")}var q=["bitcoincash:qqqqe3jhn7wu6t6nj5gq5z0y3pgsycd8h5jng9r3e7"];function o(e){return fetch("https://api.blockchair.com/bitcoin-cash/dashboards/address/"+e.toString()).then(function(e){return e.json()}).then(function(e){return e.data[Object.keys(e.data)[0]]}).catch(function(e){return console.log(e)})}function a(e,t){var n=e.reduce(function(e,t){var n=function(e){if(localStorage)return k.default.decompressFromUTF16(localStorage.getItem("T-"+e))}(t);return n?e.found[t]=n:e.remaining.push(t),e},{found:{},remaining:[]}),r=n.found,o=n.remaining;t(new Promise(function(e){return e(r)}));for(var a=0;a<o.length;a+=10)t(i(o.slice(a,Math.min(o.length,a+10))))}function i(t){return fetch("https://api.blockchair.com/bitcoin-cash/dashboards/transactions/"+t.join(",")).then(function(e){return e.json()}).catch(function(e){return console.log("txids",t,e)})}function u(t){return function(e){return fetch("https://rest.bitcoin.com/v2/rawtransactions/sendRawTransaction/"+e)}(t).then(function(e){return e.ok?e:l(t)}).then(function(e){return e.json()}).then(function(e){return console.log("broadcaster",e)}).catch(function(e){return l(t)})}function l(e){var t=new FormData;return t.append("data",e),fetch("https://api.blockchair.com/bitcoin-cash/push/transaction",{method:"POST",body:t})}function d(e,t,n,r,o){var a=new F.default.Transaction,s=t.toAddress().toString();return a.from(o),e!==s&&a.to(e,F.default.Transaction.DUST_AMOUNT),a.addData(n).change(s).fee(r).sign(t),a}function f(e,t){return e.inited=!0,e.mutation=t,e.messages=[],e.channels=[],e.refreshInterval=3e4,e.refreshTimerId=function(e,t){return e(),setInterval(e,t)}(function(){o(q[0]).then(t(y)).then(function(){e.messages=[],e.channels=[];a(e.data.transactions,function(e){e.then(t(b))})})},e.refreshInterval),e}function h(t){if(""!==t.newMessageInput&&void 0!==t.newMessageInput&&!(240<t.compressedNewMessageInput.length)){var e=t.data.utxo.map(function(e){return{txId:e.transaction_hash,outputIndex:e.index,satoshis:e.value,script:t.data.address.script_hex}}),n=d(q[0],S,k.default.compress(t.newMessageInput),284,e).serialize({disableDustOutputs:!0});return u(n).then(function(){return o(w)}).then(t.mutation(y)).then(t.mutation(I)).catch(function(e){return console.log("broadcast error",e)}),console.log("serialized",n),t}}function p(t,e){var n=prompt("New channel name");if(n&&""!==n){var r=function(){if(!localStorage)return alert("No localStorage!!! new key will not be saved!");var e=T("qqq"),t=parseInt(localStorage.getItem("channelKeyCount")||"0")+1;return localStorage.setItem("channelKeyCount",t),localStorage.setItem("channelKey-"+t,k.default.compressToUTF16(e.toWIF())),e}(),o=t.data.utxo.map(function(e){return{txId:e.transaction_hash,outputIndex:e.index,satoshis:e.value,script:t.data.address.script_hex}});u(d(q[0],S,k.default.compressToUTF16(JSON.stringify([r.toAddress().toString(),n])),285,o)).then(function(e){return e.json()}).then(function(e){return console.log("broadcasted create",result)}).catch(function(e){return console.log("broadcast create error",e)})}}function g(e,t){return e.newMessageInput=t.target.value,e.compressedNewMessageInput=k.default.compress(e.newMessageInput),e}function m(e){var t=prompt("Enter compressed key"),n=new F.default.PrivateKey.fromWIF(k.default.decompressFromUTF16(t));localStorage&&(localStorage.setItem("oldprivatekey",localStorage.getItem("privatekey")),localStorage.setItem("privatekey",t)),w=(S=n).toAddress()}function v(e){prompt("Copy compressed key!",k.default.compressToUTF16(S.toWIF()))}var y=function(e,t){return e.data=t,e},b=function(t,n){if(n.data){var e=n.data;for(var r in e){var o=e[r],a=!0,s=!1,c=void 0;try{for(var i,u=o.outputs[Symbol.iterator]();!(a=(i=u.next()).done);a=!0){var l=i.value;if(q[0].toString()!=="bitcoincash:"+l.recipient){var d=F.default.Script.fromHex(l.script_hex),f=void 0;if(d.isDataOut()){var h=!0,p=!1,g=void 0;try{for(var m,v=d.chunks[Symbol.iterator]();!(h=(m=v.next()).done);h=!0){var y=m.value;106!==y.opcodenum&&(f=y.buf.toString())}}catch(e){p=!0,g=e}finally{try{!h&&v.return&&v.return()}finally{if(p)throw g}}console.log({message:f});var b=k.default.decompressFromUTF16(f);try{var I=JSON.parse(b);t.channels.push([I[0],I[1]])}catch(e){t.messages.push(b)}T=r,x=b,localStorage&&localStorage.setItem("T-"+T,k.default.compressToUTF16(x)),console.log(l.script_hex,d.getData().toString(),b,d)}}}}catch(e){s=!0,c=e}finally{try{!a&&u.return&&u.return()}finally{if(s)throw c}}}}else for(var S in n){console.log("txid",S,n);try{var w=JSON.parse(n[S]);t.channels.push([w[0],w[1]])}catch(e){console.log(n[S],e),t.messages.push(n[S])}}var T,x;return t},I=function(e){return e.newMessageInput="",e.compressedNewMessageInput="",e},S=function(){if(localStorage){var e=localStorage.getItem("privatekey");if(e)return new F.default.PrivateKey.fromWIF(k.default.decompressFromUTF16(e));var t=T("qqq");return localStorage.setItem("privatekey",k.default.compressToUTF16(t.toWIF())),t}alert("No localStorage!!!! new key will not be saved!")}(),w=S.toAddress();function T(e){for(;;){var t=new F.default.PrivateKey;if(0===t.toAddress().toString().indexOf("bitcoincash:q"+e))return t}}console.log(w.toString());function x(e,t){var n=t.privateKey,r=t.channels,o=t.data,a=t.mutation;return c(e),(0,s.h)("addresses",null,(0,s.h)("div",null,n.toAddress().toString()),(0,s.h)("div",null,void 0!==o?0===o.address.balance?"Send Bitcoin Cash to above address":o.address.balance:"waiting for balance"),(0,s.h)("button",{onClick:a(v)},"Export Key"),(0,s.h)("button",{onClick:a(m)},"Import Key"),r?r.map(function(e){return(0,s.h)(C,{channel:e})}):void 0,(0,s.h)("button",{onClick:a(p)},"Create New Channel"))}function M(e){var t=e.message;return(0,s.h)("message",null,t)}function N(e,t){var n=t.compressedNewMessageInput,r=t.newMessageInput,o=t.messages,a=(t.transactions,t.channels,t.mutation);return c(e),(0,s.h)("viewer",null,(0,s.h)("textarea",{value:r,onInput:a(g)}),(0,s.h)("div",null,n),(0,s.h)("div",null,n?new Blob([n]).size:"0"," / 240"),(0,s.h)("button",{onClick:a(h)},"Send"),o?o.map(function(e){return(0,s.h)(M,{message:e})}):void 0)}function U(){return(0,s.h)("side-by-side",null,(0,s.h)(x,null),(0,s.h)(N,null))}var C=function(e){var t=e.channel;return(0,s.h)("channel",{title:t[0]},t[1])},O=function(){return(0,s.h)(U,null)};(0,s.render)(function(e,t){var n=t.inited,r=t.mutation;return c(e),n?(0,s.h)(O,null):r(f)(r)},{privateKey:S},document.body)},{"bitcore-lib-cash":"bitcore-lib-cash","lz-string":"lz-string","preact-cycle":"preact-cycle"}]},{},[1]);