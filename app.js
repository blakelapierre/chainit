!function o(s,c,i){function u(t,e){if(!c[t]){if(!s[t]){var n="function"==typeof require&&require;if(!e&&n)return n(t,!0);if(l)return l(t,!0);var r=new Error("Cannot find module '"+t+"'");throw r.code="MODULE_NOT_FOUND",r}var a=c[t]={exports:{}};s[t][0].call(a.exports,function(e){return u(s[t][1][e]||e)},a,a.exports,o,s,c,i)}return c[t].exports}for(var l="function"==typeof require&&require,e=0;e<i.length;e++)u(i[e]);return u}({1:[function(e,t,n){"use strict";var i=e("preact-cycle"),F=r(e("bitcore-lib-cash")),k=r(e("lz-string"));function r(e){return e&&e.__esModule?e:{default:e}}function u(e){if(null==e)throw new TypeError("Cannot destructure undefined")}var C=["bitcoincash:qqqqe3jhn7wu6t6nj5gq5z0y3pgsycd8h5jng9r3e7"];function a(e){return fetch("https://api.blockchair.com/bitcoin-cash/dashboards/address/"+e.toString()).then(function(e){return e.json()}).then(function(e){return e.data[Object.keys(e.data)[0]]}).catch(function(e){return console.log(e)})}function o(e,t){var n=e.reduce(function(e,t){var n=function(e){if(localStorage)return k.default.decompressFromUTF16(localStorage.getItem("T-"+e))}(t);return n?e.found[t]=n:e.remaining.push(t),e},{found:{},remaining:[]}),r=n.found,a=n.remaining;t(new Promise(function(e){return e(r)}));for(var o=0;o<a.length;o+=10)t(s(a.slice(o,Math.min(a.length,o+10))))}function s(t){return fetch("https://api.blockchair.com/bitcoin-cash/dashboards/transactions/"+t.join(",")).then(function(e){return e.json()}).catch(function(e){return console.log("txids",t,e)})}function c(t){return function(e){return fetch("https://rest.bitcoin.com/v2/rawtransactions/sendRawTransaction/"+e)}(t).then(function(e){return e.ok?e:l(t)}).then(function(e){return e.json()}).then(function(e){return console.log("broadcaster",e)}).catch(function(e){return l(t)})}function l(e){var t=new FormData;return t.append("data",e),fetch("https://api.blockchair.com/bitcoin-cash/push/transaction",{method:"POST",body:t})}function d(e,t,n,r,a){var o=new F.default.Transaction,s=t.toAddress().toString();return o.from(a),e!==s&&o.to(e,F.default.Transaction.DUST_AMOUNT),o.addData(n).change(s).fee(r).sign(t),o}function f(e,t){return e.inited=!0,e.mutation=t,e.messages=[],e.channels=[],e.selectedChannel=C[0],e.addressData={},e.refreshInterval=3e4,e.refreshTimerId=function(e,t){return e(),setInterval(e,t)}(function(){a(w.toString()).then(t(y,w.toString())),a(e.selectedChannel).then(t(y,e.selectedChannel)).then(function(){e.messages=[],e.channels=[];o(e.addressData[e.selectedChannel].transactions,function(e){e.then(t(S))})})},e.refreshInterval),e}function h(t){if(""!==t.newMessageInput&&void 0!==t.newMessageInput&&!(240<t.compressedNewMessageInput.length)){var e=t.addressData[w.toString()].utxo.map(function(e){return{txId:e.transaction_hash,outputIndex:e.index,satoshis:e.value,script:t.addressData[w.toString()].address.script_hex}}),n=d(C[0],I,k.default.compressToUTF16(t.newMessageInput),284,e).serialize({disableDustOutputs:!0});return c(n).then(function(){return a(w)}).then(t.mutation(y)).then(t.mutation(b)).catch(function(e){return console.log("broadcast error",e)}),console.log("serialized",n),t}}function g(t,e){var n=prompt("New channel name");if(n&&""!==n){var r=function(){if(!localStorage)return alert("No localStorage!!! new key will not be saved!");var e=T("qqq"),t=parseInt(localStorage.getItem("channelKeyCount")||"0")+1;return localStorage.setItem("channelKeyCount",t),localStorage.setItem("channelKey-"+t,k.default.compressToUTF16(e.toWIF())),e}(),a=t.addressData[w.toString()].utxo.map(function(e){return{txId:e.transaction_hash,outputIndex:e.index,satoshis:e.value,script:t.addressData[w.toString()].address.script_hex}});c(d(C[0],I,k.default.compressToUTF16(JSON.stringify([r.toAddress().toString(),n])),285,a)).then(function(e){return e.json()}).then(function(e){return console.log("broadcasted create",result)}).catch(function(e){return console.log("broadcast create error",e)})}}function p(e,t){return e.newMessageInput=t.target.value,e.compressedNewMessageInput=k.default.compress(e.newMessageInput),e}function m(e){var t=prompt("Enter compressed key"),n=new F.default.PrivateKey.fromWIF(k.default.decompressFromUTF16(t));localStorage&&(localStorage.setItem("oldprivatekey",localStorage.getItem("privatekey")),localStorage.setItem("privatekey",t)),w=(I=n).toAddress()}function v(e){prompt("Copy compressed key!",k.default.compressToUTF16(I.toWIF()))}var y=function(e,t,n){return e.addressData[t]=n,e},S=function(t,n){if(n.data){var e=n.data;for(var r in e){var a=e[r],o=!0,s=!1,c=void 0;try{for(var i,u=a.outputs[Symbol.iterator]();!(o=(i=u.next()).done);o=!0){var l=i.value;if(C[0].toString()!=="bitcoincash:"+l.recipient){var d=F.default.Script.fromHex(l.script_hex),f=void 0;if(d.isDataOut()){var h=!0,g=!1,p=void 0;try{for(var m,v=d.chunks[Symbol.iterator]();!(h=(m=v.next()).done);h=!0){var y=m.value;106!==y.opcodenum&&(f=y.buf.toString())}}catch(e){g=!0,p=e}finally{try{!h&&v.return&&v.return()}finally{if(g)throw p}}console.log({message:f});var S=k.default.decompressFromUTF16(f);try{var b=JSON.parse(S);t.channels.push([b[0],b[1]])}catch(e){t.messages.push(S)}T=r,x=S,localStorage&&localStorage.setItem("T-"+T,k.default.compressToUTF16(x)),console.log(l.script_hex,d.getData().toString(),S,d)}}}}catch(e){s=!0,c=e}finally{try{!o&&u.return&&u.return()}finally{if(s)throw c}}}}else for(var I in n){console.log("txid",I,n);try{var w=JSON.parse(n[I]);t.channels.push([w[0],w[1]])}catch(e){console.log(n[I],e),t.messages.push(n[I])}}var T,x;return t},b=function(e){return e.newMessageInput="",e.compressedNewMessageInput="",e},I=function(){if(localStorage){var e=localStorage.getItem("privatekey");if(e)return new F.default.PrivateKey.fromWIF(k.default.decompressFromUTF16(e));var t=T("qqq");return localStorage.setItem("privatekey",k.default.compressToUTF16(t.toWIF())),t}alert("No localStorage!!!! new key will not be saved!")}(),w=I.toAddress();function T(e){for(;;){var t=new F.default.PrivateKey;if(0===t.toAddress().toString().indexOf("bitcoincash:q"+e))return t}}console.log(w.toString());function x(e,t){var n=t.privateKey,r=t.channels,a=t.addressData,o=(t.data,t.mutation);return u(e),(0,i.h)("addresses",null,(0,i.h)("div",null,n.toAddress().toString()),(0,i.h)("div",null,void 0!==a[n.toAddress().toString()]?0===a[n.toAddress().toString()].address.balance?"Send Bitcoin Cash to above address":a[n.toAddress().toString()].address.balance:"waiting for balance"),(0,i.h)("button",{onClick:o(v)},"Export Key"),(0,i.h)("button",{onClick:o(m)},"Import Key"),r?r.map(function(e){return(0,i.h)(N,{channel:e})}):void 0,(0,i.h)("button",{onClick:o(g)},"Create New Channel"))}function D(e){var t=e.message;return(0,i.h)("message",null,t)}function q(e,t){var n=t.selectedChannel,r=(t.channelBalance,t.compressedNewMessageInput),a=t.newMessageInput,o=t.messages,s=(t.transactions,t.channels,t.addressData),c=t.mutation;return u(e),(0,i.h)("viewer",null,(0,i.h)("channel-id",null,n),(0,i.h)("channel-balance",null,s[n]?s[n].address.balance:"waiting for balance"),o?o.map(function(e){return(0,i.h)(D,{message:e})}):void 0,(0,i.h)("textarea",{value:a,onInput:c(p)}),(0,i.h)("button",{onClick:c(h)},"Send"),(0,i.h)("div",null,r),(0,i.h)("div",null,r?new Blob([r]).size:"0"," / 240"))}function M(){return(0,i.h)("side-by-side",null,(0,i.h)(x,null),(0,i.h)(q,null))}var N=function(e){var t=e.channel;return(0,i.h)("channel",{title:t[0]},t[1])},U=function(){return(0,i.h)(M,null)};(0,i.render)(function(e,t){var n=t.inited,r=t.mutation;return u(e),n?(0,i.h)(U,null):r(f)(r)},{privateKey:I},document.body)},{"bitcore-lib-cash":"bitcore-lib-cash","lz-string":"lz-string","preact-cycle":"preact-cycle"}]},{},[1]);