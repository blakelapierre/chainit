!function r(o,a,i){function s(n,e){if(!a[n]){if(!o[n]){var t="function"==typeof require&&require;if(!e&&t)return t(n,!0);if(c)return c(n,!0);t=new Error("Cannot find module '"+n+"'");throw t.code="MODULE_NOT_FOUND",t}t=a[n]={exports:{}};o[n][0].call(t.exports,function(e){var t=o[n][1][e];return s(t||e)},t,t.exports,r,o,a,i)}return a[n].exports}for(var c="function"==typeof require&&require,e=0;e<i.length;e++)s(i[e]);return s}({1:[function(e,t,n){var r,o;r=this,o=function(e){function c(e,t,n){this.nodeName=e,this.attributes=t,this.children=n,this.key=t&&t.key}function n(e,t){for(var n,r,o,a,i=arguments.length;2<i--;)l.push(arguments[i]);for(t&&t.children&&(l.length||l.push(t.children),delete t.children);l.length;)if((o=l.pop())instanceof Array)for(i=o.length;i--;)l.push(o[i]);else null!=o&&!0!==o&&!1!==o&&((a="string"==typeof(o="number"==typeof o?String(o):o))&&r?n[n.length-1]+=o:((n=n||[]).push(o),r=a));var s=new c(e,t||void 0,n||u);return E.vnode&&E.vnode(s),s}function w(e,t){if(t)for(var n in t)e[n]=t[n];return e}function N(e){return w({},e)}function k(e){return"function"==typeof e}function x(e){return"string"==typeof e}function r(a,e,i){var s=e.split(".");return function(e){for(var t=e&&e.target||this,n={},r=n,e=x(i)?function(e,t){for(var n=t.split("."),r=0;r<n.length&&e;r++)e=e[n[r]];return e}(e,i):t.nodeName?t.type.match(/^che|rad/)?t.checked:t.value:e,o=0;o<s.length-1;o++)r=r[s[o]]||(r[s[o]]=!o&&a.state[s[o]]||{});r[s[o]]=e,a.setState(n)}}function a(e){!e._dirty&&(e._dirty=!0)&&1==b.push(e)&&(E.debounceRendering||m)(t)}function t(){var e,t=b;for(b=[];e=t.pop();)e._dirty&&q(e)}function I(e){e=e&&e.nodeName;return e&&k(e)&&!(e.prototype&&e.prototype.render)}function T(e,t){return e.nodeName(U(e),t||v)}function C(e,t){return e.normalizedNodeName===t||d(e.nodeName)===d(t)}function U(e){var t=N(e.attributes);t.children=e.children;var n=e.nodeName.defaultProps;if(n)for(var r in n)void 0===t[r]&&(t[r]=n[r]);return t}function S(e){var t=e.parentNode;t&&t.removeChild(e)}function f(e,t,n,r,o){if("class"===(t="className"===t?"class":t)&&r&&"object"==typeof r&&(r=function(e){var t,n="";for(t in e)e[t]&&(n&&(n+=" "),n+=t);return n}(r)),"key"!==t)if("class"!==t||o)if("style"===t){if(r&&!x(r)&&!x(n)||(e.style.cssText=r||""),r&&"object"==typeof r){if(!x(n))for(var a in n)a in r||(e.style[a]="");for(var a in r)e.style[a]="number"!=typeof r[a]||g[a]?r[a]:r[a]+"px"}}else"dangerouslySetInnerHTML"===t?r&&(e.innerHTML=r.__html||""):"o"==t[0]&&"n"==t[1]?(n=e._listeners||(e._listeners={}),t=d(t.substring(2)),r?n[t]||e.addEventListener(t,i,!!y[t]):n[t]&&e.removeEventListener(t,i,!!y[t]),n[t]=r):"list"!==t&&"type"!==t&&!o&&t in e?(function(e,t,n){try{e[t]=n}catch(e){}}(e,t,null==r?"":r),null!=r&&!1!==r||e.removeAttribute(t)):(o=o&&t.match(/^xlink\:?(.+)/),null==r||!1===r?o?e.removeAttributeNS("http://www.w3.org/1999/xlink",d(o[1])):e.removeAttribute(t):"object"==typeof r||k(r)||(o?e.setAttributeNS("http://www.w3.org/1999/xlink",d(o[1]),r):e.setAttribute(t,r)));else e.className=r||""}function i(e){return this._listeners[e.type](E.event&&E.event(e)||e)}function p(e,t){var n=d(e),e=_[n]&&_[n].pop()||(t?document.createElementNS("http://www.w3.org/2000/svg",e):document.createElement(e));return e.normalizedNodeName=n,e}function M(){for(var e;e=z.pop();)E.afterMount&&E.afterMount(e),e.componentDidMount&&e.componentDidMount()}function F(e,t,n,r,o,a){B++||(K=o&&void 0!==o.ownerSVGElement,R=e&&!(W in e));r=D(e,t,n,r);return o&&r.parentNode!==o&&o.appendChild(r),--B||(R=!1,a||M()),r}function D(e,t,n,r){for(var o=t&&t.attributes&&t.attributes.ref;I(t);)t=T(t,n);if(x(t=null==t?"":t))return e&&e instanceof Text&&e.parentNode?e.nodeValue!=t&&(e.nodeValue=t):(e&&j(e),e=document.createTextNode(t)),e;if(k(t.nodeName))return function(e,t,n,r){var o=e&&e._component,a=o,i=e,s=o&&e._componentConstructor===t.nodeName,c=s,l=U(t);for(;o&&!c&&(o=o._parentComponent);)c=o.constructor===t.nodeName;o&&c&&(!r||o._component)?(O(o,l,3,n,r),e=o.base):(a&&!s&&(P(a,!0),e=i=null),o=A(t.nodeName,l,n),e&&!o.nextBase&&(o.nextBase=e,i=null),O(o,l,1,n,r),e=o.base,i&&e!==i&&(i._component=null,j(i)));return e}(e,t,n,r);var a=e,i=String(t.nodeName),s=K,c=t.children;if(K="svg"===i||"foreignObject"!==i&&K,e){if(!C(e,i)){for(a=p(i,K);e.firstChild;)a.appendChild(e.firstChild);e.parentNode&&e.parentNode.replaceChild(a,e),j(e)}}else a=p(i,K);var i=a.firstChild,l=a[W];if(!l){a[W]=l={};for(var u=a.attributes,d=u.length;d--;)l[u[d].name]=u[d].value}return!R&&c&&1===c.length&&"string"==typeof c[0]&&i&&i instanceof Text&&!i.nextSibling?i.nodeValue!=c[0]&&(i.nodeValue=c[0]):(c&&c.length||i)&&function(e,t,n,r,o){var a,i,s,c,l=e.childNodes,u=[],d={},f=0,p=0,h=l.length,m=0,v=t&&t.length;if(h)for(var g=0;g<h;g++){var y=l[g],b=y[W];null!=(_=v?(i=y._component)?i.__key:b?b.key:null:null)?(f++,d[_]=y):(R||o||b||y instanceof Text)&&(u[m++]=y)}if(v)for(g=0;g<v;g++){var _;if(s=t[g],(c=null)!=(_=s.key))f&&_ in d&&(c=d[_],d[_]=void 0,f--);else if(!c&&p<m)for(a=p;a<m;a++)if((i=u[a])&&function(e,t){return x(t)?e instanceof Text:x(t.nodeName)?!e._componentConstructor&&C(e,t.nodeName):k(t.nodeName)&&(!e._componentConstructor||e._componentConstructor===t.nodeName||I(t))}(i,s)){c=i,u[a]=void 0,a===m-1&&m--,a===p&&p++;break}(c=D(c,s,n,r))&&c!==e&&(h<=g?e.appendChild(c):c!==l[g]&&(c===l[g+1]&&S(l[g]),e.insertBefore(c,l[g]||null)))}if(f)for(var g in d)d[g]&&j(d[g]);for(;p<=m;)(c=u[m--])&&j(c)}(a,c,n,r,!!l.dangerouslySetInnerHTML),function(e,t,n){for(var r in n)t&&r in t||null==n[r]||f(e,r,n[r],n[r]=void 0,K);if(t)for(r in t)"children"===r||"innerHTML"===r||r in n&&t[r]===("value"===r||"checked"===r?e:n)[r]||f(e,r,n[r],n[r]=t[r],K)}(a,t.attributes,l),o&&(l.ref=o)(a),K=s,a}function j(e,t){var n,r,o=e._component;if(o)P(o,!t);else for(e[W]&&e[W].ref&&e[W].ref(null),t||(S(r=e),r instanceof Element&&(r._component=r._componentConstructor=null,o=r.normalizedNodeName||d(r.nodeName),(_[o]||(_[o]=[])).push(r)));n=e.lastChild;)j(n,t)}function A(e,t,n){var r=new e(t,n),o=L[e.name];if(s.call(r,t,n),o)for(var a=o.length;a--;)if(o[a].constructor===e){r.nextBase=o[a].nextBase,o.splice(a,1);break}return r}function O(e,t,n,r,o){e._disable||(e._disable=!0,(e.__ref=t.ref)&&delete t.ref,(e.__key=t.key)&&delete t.key,!e.base||o?e.componentWillMount&&e.componentWillMount():e.componentWillReceiveProps&&e.componentWillReceiveProps(t,r),r&&r!==e.context&&(e.prevContext||(e.prevContext=e.context),e.context=r),e.prevProps||(e.prevProps=e.props),e.props=t,e._disable=!1,0!==n&&(1!==n&&!1===E.syncComponentUpdates&&e.base?a(e):q(e,1,o)),e.__ref&&e.__ref(e))}function q(e,t,n,r){if(!e._disable){var o,a,i=e.props,s=e.state,c=e.context,l=e.prevProps||i,u=e.prevState||s,d=e.prevContext||c,f=e.base,p=e.nextBase,h=f||p,m=e._component;if(f&&(e.props=l,e.state=u,e.context=d,2!==t&&e.shouldComponentUpdate&&!1===e.shouldComponentUpdate(i,s,c)?o=!0:e.componentWillUpdate&&e.componentWillUpdate(i,s,c),e.props=i,e.state=s,e.context=c),e.prevProps=e.prevState=e.prevContext=e.nextBase=null,e._dirty=!1,!o){for(e.render&&(a=e.render(i,s,c)),e.getChildContext&&(c=w(N(c),e.getChildContext()));I(a);)a=T(a,c);var v,g,y,b,s=a&&a.nodeName;if(k(s)?(y=U(a),(b=m)&&b.constructor===s&&y.key==b.__key?O(b,y,1,c):(v=b,(b=A(s,y,c)).nextBase=b.nextBase||p,O((b._parentComponent=e)._component=b,y,0,c),q(b,1,n,!0)),g=b.base):(y=h,(v=m)&&(y=e._component=null),!h&&1!==t||(y&&(y._component=null),g=F(y,a,c,n||!f,h&&h.parentNode,!0))),!h||g===h||b===m||(m=h.parentNode)&&g!==m&&(m.replaceChild(g,h),v||(h._component=null,j(h))),v&&P(v,g!==h),(e.base=g)&&!r){for(var _=e,x=e;x=x._parentComponent;)(_=x).base=g;g._component=_,g._componentConstructor=_.constructor}}!f||n?z.unshift(e):o||(e.componentDidUpdate&&e.componentDidUpdate(l,u,d),E.afterUpdate&&E.afterUpdate(e));var C,S=e._renderCallbacks;if(S)for(;C=S.pop();)C.call(e);B||r||M()}}function P(e,t){E.beforeUnmount&&E.beforeUnmount(e);var n=e.base;e._disable=!0,e.componentWillUnmount&&e.componentWillUnmount(),e.base=null;var r,o,a,i=e._component;if(i)P(i,t);else if(n)for(n[W]&&n[W].ref&&n[W].ref(null),e.nextBase=n,t&&(S(n),a=(o=e).constructor.name,(i=L[a])?i.push(o):L[a]=[o]);r=n.lastChild;)j(r,!t);e.__ref&&e.__ref(null),e.componentDidUnmount&&e.componentDidUnmount()}function s(e,t){this._dirty=!0,this.context=t,this.props=e,this.state||(this.state={})}var E={},l=[],u=[],o={},d=function(e){return o[e]||(o[e]=e.toLowerCase())},h="undefined"!=typeof Promise&&Promise.resolve(),m=h?function(e){h.then(e)}:setTimeout,v={},W="undefined"!=typeof Symbol?Symbol.for("preactattr"):"__preactattr_",g={boxFlex:1,boxFlexGroup:1,columnCount:1,fillOpacity:1,flex:1,flexGrow:1,flexPositive:1,flexShrink:1,flexNegative:1,fontWeight:1,lineClamp:1,lineHeight:1,opacity:1,order:1,orphans:1,strokeOpacity:1,widows:1,zIndex:1,zoom:1},y={blur:1,error:1,focus:1,load:1,resize:1,scroll:1},b=[],_={},z=[],B=0,K=!1,R=!1,L={};w(s.prototype,{linkState:function(e,t){var n=this._linkedStates||(this._linkedStates={});return n[e+t]||(n[e+t]=r(this,e,t))},setState:function(e,t){var n=this.state;this.prevState||(this.prevState=N(n)),w(n,k(e)?e(n,this.props):e),t&&(this._renderCallbacks=this._renderCallbacks||[]).push(t),a(this)},forceUpdate:function(){q(this,2)},render:function(){}}),e.h=n,e.cloneElement=function(e,t){return n(e.nodeName,w(N(e.attributes),t),2<arguments.length?[].slice.call(arguments,2):e.children)},e.Component=s,e.render=function(e,t,n){return F(n,e,{},!1,t)},e.rerender=t,e.options=E},"object"==typeof n&&void 0!==t?o(n):"function"==typeof define&&define.amd?define(["exports"],o):o(r.preact=r.preact||{})},{}],2:[function(e,t,n){"use strict";var i=e("preact-cycle"),k=r(e("bitcore-lib-cash")),I=r(e("lz-string")),s=e("./code-runner");function r(e){return e&&e.__esModule?e:{default:e}}function a(e){if(null==e)throw new TypeError("Cannot destructure undefined")}var c=["bitcoincash:qqqqe3jhn7wu6t6nj5gq5z0y3pgsycd8h5jng9r3e7"];function l(e){return fetch("https://api.blockchair.com/bitcoin-cash/dashboards/address/"+e.toString()).then(function(e){return e.json()}).then(function(e){return e.data[Object.keys(e.data)[0]]}).catch(function(e){return console.log(e)})}function u(e,t){var e=e.reduce(function(e,t){var n=function(e){if(localStorage)return I.default.decompressFromUTF16(localStorage.getItem("T-"+e))}(t);return n?e.found[t]=n:e.remaining.push(t),e},{found:{},remaining:[]}),n=e.found,r=e.remaining;t(new Promise(function(e){return e(n)}));for(var o=0;o<r.length;o+=10)t(function(t){return fetch("https://api.blockchair.com/bitcoin-cash/dashboards/transactions/"+t.join(",")).then(function(e){return e.json()}).catch(function(e){return console.log("txids",t,e)})}(r.slice(o,Math.min(r.length,o+10))))}function d(t){return fetch("https://rest.bitcoin.com/v2/rawtransactions/sendRawTransaction/"+t).then(function(e){return e.ok?e:o(t)}).then(function(e){return e.json()}).then(function(e){return console.log("broadcaster",e)}).catch(function(e){return o(t)})}function o(e){var t=new FormData;return t.append("data",e),fetch("https://api.blockchair.com/bitcoin-cash/push/transaction",{method:"POST",body:t})}function f(e,t,n,r,o){var a=new k.default.Transaction,i=t.toAddress().toString();return a.from(o),e!==i&&a.to(e,k.default.Transaction.DUST_AMOUNT),a.addData(n).change(i).fee(r).sign(t),a}function p(e,t){return e.inited=!0,e.mutation=t,e.messages={},e.channels={},e.channels[c[0]]={name:"root",id:c[0]},e.addressData={},e.refreshInterval=3e4,e}function h(t){if(""!==t.newMessageInput&&void 0!==t.newMessageInput&&!(240<t.compressedNewMessageInput.length)){var e=t.addressData[w.toString()].utxo.map(function(e){return{txId:e.transaction_hash,outputIndex:e.index,satoshis:e.value,script:t.addressData[w.toString()].address.script_hex}}),e=f(t.selectedChannel,S,I.default.compressToUTF16(t.newMessageInput),284,e).serialize({disableDustOutputs:!0});return d(e).then(function(){return l(w)}).then(t.mutation(b)).then(t.mutation(x)).catch(function(e){return console.log("broadcast error",e)}),console.log("serialized",e),t}}function m(t,e){var n,r,o=prompt("New channel name");o&&""!==o&&(n=function(){if(!localStorage)return alert("No localStorage!!! new key will not be saved!");var e=N("qqq"),t=parseInt(localStorage.getItem("channelKeyCount")||"0")+1;return localStorage.setItem("channelKeyCount",t),localStorage.setItem("channelKey-"+t,I.default.compressToUTF16(e.toWIF())),e}(),r=t.addressData[w.toString()].utxo.map(function(e){return{txId:e.transaction_hash,outputIndex:e.index,satoshis:e.value,script:t.addressData[w.toString()].address.script_hex}}),d(f(c[0],S,I.default.compressToUTF16(JSON.stringify([n.toAddress().toString(),o])),285,r)).then(function(e){return e.json()}).then(function(e){return console.log("broadcasted create",result)}).catch(function(e){return console.log("broadcast create error",e)}))}function v(e,t){return e.newMessageInput=t.target.value,e.compressedNewMessageInput=I.default.compress(e.newMessageInput),e}function g(e){var t=prompt("Enter compressed key"),n=new k.default.PrivateKey.fromWIF(I.default.decompressFromUTF16(t));localStorage&&(localStorage.setItem("oldprivatekey",localStorage.getItem("privatekey")),localStorage.setItem("privatekey",t)),w=(S=n).toAddress()}function y(e){prompt("Copy compressed key!",I.default.compressToUTF16(S.toWIF()))}var e=function(e,t){var n,r,o;return e.selectedChannel=t,r=(n=e).mutation,o=n.selectedChannel,n.messages={},n.messages[o]=n.messages[o]||[],l(o).then(r(b,o)).then(function(){u(n.addressData[o].transactions,function(e){e.then(r(_,o))})}),e},b=function(e,t,n){return e.addressData[t]=n,e},_=function(t,n,r){if(r.data){var e,o=r.data;for(e in o){var a=o[e],i=!0,s=!1,c=void 0;try{for(var l,u=a.outputs[Symbol.iterator]();!(i=(l=u.next()).done);i=!0){var d=l.value;if(t.selectedChannel.toString()!=="bitcoincash:"+d.recipient){var f=k.default.Script.fromHex(d.script_hex),p=void 0;if(f.isDataOut()){var h=!0,m=!1,v=void 0;try{for(var g,y=f.chunks[Symbol.iterator]();!(h=(g=y.next()).done);h=!0){var b=g.value;106!==b.opcodenum&&(p=b.buf.toString())}}catch(e){m=!0,v=e}finally{try{!h&&y.return&&y.return()}finally{if(m)throw v}}var _=I.default.decompressFromUTF16(p);try{var x=JSON.parse(_);t.channels[x[0]]={name:x[1],id:x[0]}}catch(e){t.messages[n].push(_)}w=e,N=_,localStorage&&localStorage.setItem("T-"+w,I.default.compressToUTF16(N))}}}}catch(e){s=!0,c=e}finally{try{!i&&u.return&&u.return()}finally{if(s)throw c}}}}else for(var C in r)try{var S=JSON.parse(r[C]);t.channels[S[0]]={name:S[1],id:S[0]}}catch(e){t.messages[n].push(r[C])}var w,N;return t},x=function(e){return e.newMessageInput="",e.compressedNewMessageInput="",e},C=e,S=function(){if(localStorage){var e=localStorage.getItem("privatekey");if(e)return new k.default.PrivateKey.fromWIF(I.default.decompressFromUTF16(e));e=N("qqq");return localStorage.setItem("privatekey",I.default.compressToUTF16(e.toWIF())),e}alert("No localStorage!!!! new key will not be saved!")}(),w=S.toAddress();function N(e){for(;;){var t=new k.default.PrivateKey;if(0===t.toAddress().toString().indexOf("bitcoincash:q"+e))return t}}console.log(w.toString());function T(e,t){var n=t.privateKey,r=t.channels,o=t.addressData,t=(t.data,t.mutation);return a(e),(0,i.h)("addresses",null,(0,i.h)("div",null,n.toAddress().toString()),(0,i.h)("div",null,void 0!==o[n.toAddress().toString()]?0===o[n.toAddress().toString()].address.balance?"Send Bitcoin Cash to above address":o[n.toAddress().toString()].address.balance:"waiting for balance"),(0,i.h)("button",{onClick:t(y)},"Export Key"),(0,i.h)("button",{onClick:t(g)},"Import Key"),r?Object.keys(r).map(function(e){return(0,i.h)(D,{channel:r[e]})}):void 0,(0,i.h)("button",{onClick:t(m)},"Create New Channel"))}function U(e){return e=e.message,(0,i.h)("message",null,e)}function M(e,t){var n=e.channel,r=(t.channelBalance,t.compressedNewMessageInput),o=t.newMessageInput,a=t.messages,e=(t.transactions,t.channels,t.addressData),t=t.mutation;return(0,i.h)("viewer",null,(0,i.h)("channel-id",null,n),(0,i.h)("channel-balance",null,e[n]?e[n].address.balance:"waiting for balance"),a?a[n].map(function(e){return(0,i.h)(U,{message:e})}):void 0,(0,i.h)("textarea",{value:o,onInput:t(v)}),(0,i.h)("button",{onClick:t(h)},"Send"),(0,i.h)("div",null,r),(0,i.h)("div",null,r?new Blob([r]).size:"0"," / 240"),(0,i.h)(s.CodeRunner,{code:"alert('test')"}))}function F(e){return e=e.selectedChannel,(0,i.h)("side-by-side",null,(0,i.h)(T,null),(0,i.h)(M,{channel:e}))}var D=function(e,t){e=e.channel,t=t.mutation;return(0,i.h)("channel",{title:e.id,onClick:t(C,e.id)},e.name)},j=function(e){e=e.selectedChannel;return(0,i.h)(F,{selectedChannel:e})};(0,i.render)(function(e,t){var n=t.inited,r=t.selectedChannel,t=t.mutation;return a(e),n?(0,i.h)(j,{selectedChannel:r}):t(p)(t)},{selectedChannel:c[0],privateKey:S},document.body)},{"./code-runner":3,"bitcore-lib-cash":"bitcore-lib-cash","lz-string":"lz-string","preact-cycle":"preact-cycle"}],3:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.CodeRunner=void 0;function r(e,t,n){var r="make random?";prompt("This code may have access to your private keys and anything else currently on this page. Are you sure you want to run it? If so, please type "+r)===r&&((r=document.createElement("script")).src="data:text/javascript,"+encodeURIComponent(t),n.target.parentElement.appendChild(r))}var o=e("preact-cycle");e("preact");n.CodeRunner=function(e,t){e=e.code,t=t.mutation;return(0,o.h)("code-runner",null,(0,o.h)("code-text",null,e),(0,o.h)("button",{onClick:t(r,e)},"Run Code"))}},{preact:1,"preact-cycle":"preact-cycle"}]},{},[2]);