!function o(s,i,c){function u(t,e){if(!i[t]){if(!s[t]){var n="function"==typeof require&&require;if(!e&&n)return n(t,!0);if(l)return l(t,!0);var r=new Error("Cannot find module '"+t+"'");throw r.code="MODULE_NOT_FOUND",r}var a=i[t]={exports:{}};s[t][0].call(a.exports,function(e){return u(s[t][1][e]||e)},a,a.exports,o,s,i,c)}return i[t].exports}for(var l="function"==typeof require&&require,e=0;e<c.length;e++)u(c[e]);return u}({1:[function(e,t,n){"use strict";var s=e("preact-cycle"),q=r(e("bitcore-lib-cash")),F=r(e("lz-string"));function r(e){return e&&e.__esModule?e:{default:e}}function i(e){if(null==e)throw new TypeError("Cannot destructure undefined")}var M=["bitcoincash:qqqqe3jhn7wu6t6nj5gq5z0y3pgsycd8h5jng9r3e7"];function a(e){return fetch("https://api.blockchair.com/bitcoin-cash/dashboards/address/"+e.toString()).then(function(e){return e.json()}).then(function(e){return e.data[Object.keys(e.data)[0]]}).catch(function(e){return console.log(e)})}function o(e,t){var n=e.reduce(function(e,t){var n=function(e){if(localStorage)return F.default.decompressFromUTF16(localStorage.getItem("T-"+e))}(t);return n?e.found[t]=n:e.remaining.push(t),e},{found:{},remaining:[]}),r=n.found,a=n.remaining;t(new Promise(function(e){return e(r)}));for(var o=0;o<a.length;o+=10)t(c(a.slice(o,Math.min(a.length,o+10))))}function c(t){return fetch("https://api.blockchair.com/bitcoin-cash/dashboards/transactions/"+t.join(",")).then(function(e){return e.json()}).catch(function(e){return console.log("txids",t,e)})}function u(t){return function(e){return fetch("https://rest.bitcoin.com/v2/rawtransactions/sendRawTransaction/"+e)}(t).then(function(e){return e.ok?e:l(t)}).then(function(e){return e.json()}).then(function(e){return console.log("broadcaster",e)}).catch(function(e){return l(t)})}function l(e){var t=new FormData;return t.append("data",e),fetch("https://api.blockchair.com/bitcoin-cash/push/transaction",{method:"POST",body:t})}function d(e,t,n,r,a){var o=new q.default.Transaction,s=t.toAddress().toString();return o.from(a),e!==s&&o.to(e,q.default.Transaction.DUST_AMOUNT),o.addData(n).change(s).fee(r).sign(t),o}function f(e,t){return e.inited=!0,e.mutation=t,e.messages=[],e.channels=[],e.refreshInterval=3e4,e.refreshTimerId=function(e,t){return e(),setInterval(e,t)}(function(){a(M[0]).then(t(v)).then(function(){e.messages=[],e.channels=[];o(e.data.transactions,function(e){e.then(t(m))})})},e.refreshInterval),e}function h(t){if(""!==t.newMessageInput&&void 0!==t.newMessageInput&&!(240<t.compressedNewMessageInput.length)){var e=t.data.utxo.map(function(e){return{txId:e.transaction_hash,outputIndex:e.index,satoshis:e.value,script:t.data.address.script_hex}}),n=d(M[0],y,F.default.compress(t.newMessageInput),284,e).serialize({disableDustOutputs:!0});return u(n).then(function(){return a(w)}).then(t.mutation(v)).then(t.mutation(b)).catch(function(e){return console.log("broadcast error",e)}),console.log("serialized",n),t}}function p(t,e){var n=prompt("New channel name");if(n&&""!==n){var r=function(){if(!localStorage)return alert("No localStorage!!! new key will not be saved!");var e=S("qqq"),t=parseInt(localStorage.getItem("channelKeyCount")||"0")+1;return localStorage.setItem("channelKeyCount",t),localStorage.setItem("channelKey-"+t,F.default.compressToUTF16(e.toWIF())),e}(),a=t.data.utxo.map(function(e){return{txId:e.transaction_hash,outputIndex:e.index,satoshis:e.value,script:t.data.address.script_hex}});u(d(M[0],y,F.default.compressToUTF16(JSON.stringify([r.toAddress().toString(),n])),285,a)).then(function(e){return e.json()}).then(function(e){return console.log("broadcasted create",result)}).catch(function(e){return console.log("broadcast create error",e)})}}function g(e,t){return e.newMessageInput=t.target.value,e.compressedNewMessageInput=F.default.compress(e.newMessageInput),e}var v=function(e,t){return e.data=t,e},m=function(t,n){if(n.data){var e=n.data;for(var r in e){var a=e[r],o=!0,s=!1,i=void 0;try{for(var c,u=a.outputs[Symbol.iterator]();!(o=(c=u.next()).done);o=!0){var l=c.value;if(M[0].toString()!=="bitcoincash:"+l.recipient){var d=q.default.Script.fromHex(l.script_hex),f=void 0;if(d.isDataOut()){var h=!0,p=!1,g=void 0;try{for(var v,m=d.chunks[Symbol.iterator]();!(h=(v=m.next()).done);h=!0){var b=v.value;106!==b.opcodenum&&(f=b.buf.toString())}}catch(e){p=!0,g=e}finally{try{!h&&m.return&&m.return()}finally{if(p)throw g}}console.log({message:f});var y=F.default.decompressFromUTF16(f);try{var w=JSON.parse(y);t.channels.push([w[0],w[1]])}catch(e){t.messages.push(y)}x=r,T=y,localStorage&&localStorage.setItem("T-"+x,F.default.compressToUTF16(T)),console.log(l.script_hex,d.getData().toString(),y,d)}}}}catch(e){s=!0,i=e}finally{try{!o&&u.return&&u.return()}finally{if(s)throw i}}}}else for(var S in n){console.log("txid",S,n);try{var I=JSON.parse(n[S]);t.channels.push([I[0],I[1]])}catch(e){console.log(n[S],e),t.messages.push(n[S])}}var x,T;return t},b=function(e){return e.newMessageInput="",e.compressedNewMessageInput="",e},y=function(){if(localStorage){var e=localStorage.getItem("privatekey");if(e)return new q.default.PrivateKey.fromWIF(F.default.decompressFromUTF16(e));var t=S("qqq");return localStorage.setItem("privatekey",F.default.compressToUTF16(t.toWIF())),t}alert("No localStorage!!!! new key will not be saved!")}(),w=y.toAddress();function S(e){for(;;){var t=new q.default.PrivateKey;if(0===t.toAddress().toString().indexOf("bitcoincash:q"+e))return t}}console.log(w.toString());function I(e,t){var n=t.privateKey,r=t.channels,a=t.data,o=t.mutation;return i(e),(0,s.h)("addresses",null,(0,s.h)("div",null,n.toAddress().toString()),(0,s.h)("div",null,void 0!==a?0===a.address.balance?"Send Bitcoin Cash to above address":a.address.balance:"waiting for balance"),r?r.map(function(e){return(0,s.h)(k,{channel:e})}):void 0,(0,s.h)("button",{onClick:o(p)},"Create New Channel"))}function x(e){var t=e.message;return(0,s.h)("message",null,t)}function T(e,t){var n=t.compressedNewMessageInput,r=t.newMessageInput,a=t.messages,o=(t.transactions,t.channels,t.mutation);return i(e),(0,s.h)("viewer",null,(0,s.h)("textarea",{value:r,onInput:o(g)}),(0,s.h)("div",null,n),(0,s.h)("div",null,n?new Blob([n]).size:"0"," / 240"),(0,s.h)("button",{onClick:o(h)},"Send"),a?a.map(function(e){return(0,s.h)(x,{message:e})}):void 0)}function N(){return(0,s.h)("side-by-side",null,(0,s.h)(I,null),(0,s.h)(T,null))}var k=function(e){var t=e.channel;return(0,s.h)("channel",{title:t[0]},t[1])},O=function(){return(0,s.h)(N,null)};(0,s.render)(function(e,t){var n=t.inited,r=t.mutation;return i(e),n?(0,s.h)(O,null):r(f)(r)},{privateKey:y},document.body)},{"bitcore-lib-cash":"bitcore-lib-cash","lz-string":"lz-string","preact-cycle":"preact-cycle"}]},{},[1]);